<!doctype html>
<html lang="en-us">
	<head>
		<meta charset="utf-8">
		<title>How to Build a Monotron Synth with the Web Audio API</title>
		<meta name="description" content="Recreate the Korg Monotron synthesizer with JavaScript and the Web Audio API.">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="canonical" href="http://noisehack.com/how-to-build-monotron-synth-web-audio-api/">
		<link href="//fonts.googleapis.com/css?family=Iceberg|Source+Sans+Pro:400,700,400italic,700italic" rel="stylesheet" type="text/css">
		<link rel="stylesheet" href="../css/main.css">
		<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
		<script src="../js/main.js"></script>
	</head>
	<body>
		<header role="banner">
			<h1><a href="../">Noisehack</a></h1>
			<nav>
			<ul>
				<li><a href="../about/">About</a></li>
				<li><a href="../archives/">Archives</a></li>
				<li><a href="http://feeds.feedburner.com/noisehack">RSS</a></li>
				<li><a href="https://twitter.com/noisehack">Twitter</a></li>
			</ul>
			</nav>
		</header>

		<div id="container">
		<article>
  <h1>How to Build a Monotron Synth with the Web Audio API</h1>
  <div class="figure">
<img src="https://lh3.googleusercontent.com/-IB3Rw79rchE/Uf2tCgK4LyI/AAAAAAAAxvk/WT5SFo6O8Ug/s0/kor-monotron_3.jpg" alt="Korg Monotron synthesizer" /><p class="caption">Korg Monotron synthesizer</p>
</div>
<p>The <a href="http://www.amazon.com/dp/B003DX96TW/?tag=zacden-20">Monotron</a> is an awesome little analog synth by Korg. In this post, you’ll learn how to recreate the Monotron with the Web Audio API.</p>
<p>This is a long post, so to get an idea of what you’re building, check out <a href="http://noisehack.com/monotron/">the demo</a> and <a href="https://github.com/zacharydenton/monotron">the code on GitHub</a>.</p>
<!--more-->
<h2 id="overview">Overview</h2>
<div class="figure">
<img src="https://lh6.googleusercontent.com/-XqwhLdsOnu8/Uf2tCqvJQtI/AAAAAAAAxuU/X_IIwkkIviA/s0/monotron_Block_diagram+%25281%2529.jpg" alt="Monotron block diagram" /><p class="caption">Monotron block diagram</p>
</div>
<p>The Monotron is <a href="https://lh3.googleusercontent.com/-PqNb9yqvPxQ/Uf2tCpIWLgI/AAAAAAAAxuc/AN95hjSJBzI/s0/monotron_sch+%25281%2529.jpg">a fairly simple synthesizer</a>, consisting of a sawtooth oscillator (VCO), an LFO, and a lowpass filter (VCF). It’s monophonic, which means that only one note can be played at a time.</p>
<p>To recreate this synth, we’ll break things up into three components. First we’ve got the <em>audio circuit</em>, which generates sound with the Web Audio API. Next, we’ve got the <em>control panel</em>, which corresponds to the different knobs and switches on the Monotron. Finally, we’ve got the <em>ribbon keyboard</em>, which triggers notes in response to user input.</p>
<p>The Monotron’s ribbon keyboard is interesting: the transitions between notes are seamless, so by sweeping your finger across the keyboard you get a continuous change in pitch, like a <a href="https://en.wikipedia.org/wiki/Theremin">theremin</a>. Quickly moving your finger back and forth produces a cool vibrato effect.</p>
<h2 id="the-audio-circuit">The Audio Circuit</h2>
<p>Let’s get started by implementing the core audio circuit. We’ll use an <code>OscillatorNode</code> for the VCO and LFO and a <code>BiquadFilterNode</code> for the VCF. We’ll encapsulate all of this functionality in a single <code>Monotron</code> class:</p>
<pre class="sourceCode coffee"><code class="sourceCode coffee"><span class="kw">class</span> <span class="dt">Monotron</span>
  <span class="kw">constructor:</span> <span class="fu">(@context) -&gt;</span>
    <span class="dt">@vco</span> <span class="kw">=</span> <span class="dt">@context</span><span class="kw">.</span>createOscillator<span class="kw">()</span>
    <span class="dt">@lfo</span> <span class="kw">=</span> <span class="dt">@context</span><span class="kw">.</span>createOscillator<span class="kw">()</span>
    <span class="dt">@lfoGain</span> <span class="kw">=</span> <span class="dt">@context</span><span class="kw">.</span>createGain<span class="kw">()</span>
    <span class="dt">@vcf</span> <span class="kw">=</span> <span class="dt">@context</span><span class="kw">.</span>createBiquadFilter<span class="kw">()</span>
    <span class="dt">@output</span> <span class="kw">=</span> <span class="dt">@context</span><span class="kw">.</span>createGain<span class="kw">()</span>

    <span class="dt">@vco</span><span class="kw">.</span>connect <span class="dt">@vcf</span>
    <span class="dt">@vcf</span><span class="kw">.</span>connect <span class="dt">@output</span>
    <span class="dt">@lfo</span><span class="kw">.</span>connect <span class="dt">@lfoGain</span>
    <span class="dt">@lfoGain</span><span class="kw">.</span>connect <span class="dt">@vcf</span><span class="kw">.</span>frequency

    <span class="dt">@output</span><span class="kw">.</span>gain<span class="kw">.</span>value <span class="kw">=</span> <span class="dv">0</span>
    <span class="dt">@vco</span><span class="kw">.</span>type <span class="kw">=</span> <span class="dt">@vco</span><span class="kw">.</span>SAWTOOTH
    <span class="dt">@lfo</span><span class="kw">.</span>type <span class="kw">=</span> <span class="dt">@lfo</span><span class="kw">.</span>SAWTOOTH
    <span class="dt">@vco</span><span class="kw">.</span>start <span class="dt">@context</span><span class="kw">.</span>currentTime
    <span class="dt">@lfo</span><span class="kw">.</span>start <span class="dt">@context</span><span class="kw">.</span>currentTime

  noteOn<span class="kw">:</span> <span class="fu">(frequency, time) -&gt;</span>
    time <span class="kw">?=</span> <span class="dt">@context</span><span class="kw">.</span>currentTime
    <span class="dt">@vco</span><span class="kw">.</span>frequency<span class="kw">.</span>setValueAtTime frequency<span class="kw">,</span> time
    <span class="dt">@output</span><span class="kw">.</span>gain<span class="kw">.</span>linearRampToValueAtTime <span class="fl">1.0</span><span class="kw">,</span> time <span class="kw">+</span> <span class="fl">0.1</span>

  noteOff<span class="kw">:</span> <span class="fu">(time) -&gt;</span>
    time <span class="kw">?=</span> <span class="dt">@context</span><span class="kw">.</span>currentTime
    <span class="dt">@output</span><span class="kw">.</span>gain<span class="kw">.</span>linearRampToValueAtTime <span class="fl">0.0</span><span class="kw">,</span> time <span class="kw">+</span> <span class="fl">0.1</span>

  connect<span class="kw">:</span> <span class="fu">(target) -&gt;</span>
    <span class="dt">@output</span><span class="kw">.</span>connect target</code></pre>
<p>So the first thing the <code>Monotron</code> constructor does is create the required audio nodes. As mentioned previously, we have the VCO, LFO, and VCF – but we also have two GainNodes: <code>@lfoGain</code> and <code>@output</code>. <code>@lfoGain</code> controls how much of an effect the LFO has on the overall sound – it corresponds to the Monotron’s LFO intensity knob. <code>@output</code> is just a pattern I use when making Web Audio API instruments: it’s always the final node in the instrument’s audio circuit, which gives these instruments a consistent interface.</p>
<p>The second thing the constructor does is connect the audio nodes together to form the audio circuit. This corresponds to the Monotron block diagram above. The VCO is connected to the VCF, which is then connected to the <code>@output</code> node. Then the LFO is connected to the LFO amplifier (<code>@lfoGain</code>), which (by default) is connected to the VCF’s cutoff frequency. In addition to modulating the VCF, The Monotron also supports modulating the VCO, which we’ll implement later.</p>
<p>Finally, the constructor sets up some default parameters. The first thing we want to do is silence the <code>@output</code> node. If we didn’t, the Monotron would start making noise as soon as it’s connected. Second, we specify that the VCO and LFO should produce sawtooth waves, just like on the real Monotron. Finally, we start the VCO and LFO. This is something that confused me when I first started programming synths: oscillators actually remain “on” even when no note is being played. Thus we need a way to shape the sound into separate notes.</p>
<p>In the <code>noteOn</code> method, the first thing is to schedule a change in VCO pitch<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>. Notice that <code>time</code> is an optional parameter: if not specified, the pitch changes immediately. This way, the Monotron can also be used with a sequencer which schedules notes ahead of time. Next, we ramp the <code>@output</code> to full volume over a 0.1 second interval. (This helps minimize “clicks” when notes are played.) The <code>noteOff</code> method does the same, in reverse.</p>
<p>Lastly, we have the <code>connect</code> method. Like <code>@output</code>, this is a pattern I use with all Web Audio synths, and is used in the same way as the <code>connect</code> method of any <code>AudioNode</code>. For instance, to hook the Monotron up to your speakers, you would use:</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> audioContext = <span class="kw">new</span> <span class="fu">webkitAudioContext</span>();
<span class="kw">var</span> monotron = <span class="kw">new</span> <span class="fu">Monotron</span>(audioContext);
<span class="ot">monotron</span>.<span class="fu">connect</span>(<span class="ot">audioContext</span>.<span class="fu">destination</span>);</code></pre>
<p>Then you can play notes in the console like this:</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="ot">monotron</span>.<span class="fu">noteOn</span>(<span class="dv">440</span>);
<span class="ot">monotron</span>.<span class="fu">noteOn</span>(<span class="fl">261.6</span>);
<span class="ot">monotron</span>.<span class="fu">noteOff</span>();</code></pre>
<p>Which is cool, but it’s not an instrument yet.</p>
<h2 id="the-control-panel">The Control Panel</h2>
<p>At this point, we have code that generates sound, but to make this a real synthesizer we need a user interface. The Monotron has five knobs to tweak the audio circuit and a switch to specify what the LFO modulates. It also has a unique black and white visual style. It’s definitely worth the effort to make your synths look good.</p>
<p>So let’s get started. We’ll define the skeleton like this:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;monotron&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;brand&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;h1</span><span class="ot"> id=</span><span class="st">&quot;title&quot;</span><span class="kw">&gt;</span>Monotron<span class="kw">&lt;/h1&gt;</span>
    <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;description&quot;</span><span class="kw">&gt;</span>Analogue Ribbon Synthesizer<span class="kw">&lt;/div&gt;</span>
  <span class="kw">&lt;/div&gt;</span>
  <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;controls&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;panel&quot;</span><span class="kw">&gt;</span>
      <span class="kw">&lt;label&gt;</span>
      <span class="kw">&lt;select</span><span class="ot"> id=</span><span class="st">&quot;mod&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;option&gt;</span>Standby<span class="kw">&lt;/option&gt;</span>
        <span class="kw">&lt;option&gt;</span>Pitch<span class="kw">&lt;/option&gt;</span>
        <span class="kw">&lt;option&gt;</span>Cutoff<span class="kw">&lt;/option&gt;</span>
      <span class="kw">&lt;/select&gt;</span>
      <span class="kw">&lt;br</span> <span class="kw">/&gt;</span>Mod
      <span class="kw">&lt;/label&gt;</span>
    <span class="kw">&lt;/div&gt;</span>
    <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;panel&quot;</span><span class="kw">&gt;</span>
      <span class="kw">&lt;h2&gt;</span>VCO<span class="kw">&lt;/h2&gt;</span>
      <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;knobs&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;knob&quot;</span><span class="kw">&gt;</span>
          <span class="kw">&lt;input</span><span class="ot"> id=</span><span class="st">&quot;pitch&quot;</span><span class="ot"> type=</span><span class="st">&quot;range&quot;</span><span class="ot"> min=</span><span class="st">&quot;0&quot;</span><span class="ot"> max=</span><span class="st">&quot;100&quot;</span><span class="ot"> data-width=</span><span class="st">&quot;40&quot;</span><span class="ot"> data-height=</span><span class="st">&quot;40&quot;</span><span class="ot"> data-angleOffset=</span><span class="st">&quot;220&quot;</span><span class="ot"> data-angleRange=</span><span class="st">&quot;280&quot;</span><span class="kw">&gt;</span>
          <span class="kw">&lt;label&gt;</span>Pitch<span class="kw">&lt;/label&gt;</span>
        <span class="kw">&lt;/div&gt;</span>
      <span class="kw">&lt;/div&gt;</span>
    <span class="kw">&lt;/div&gt;</span>
    <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;panel&quot;</span><span class="kw">&gt;</span>
      <span class="kw">&lt;h2&gt;</span>LFO<span class="kw">&lt;/h2&gt;</span>
      <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;knobs&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;knob&quot;</span><span class="kw">&gt;</span>
          <span class="kw">&lt;input</span><span class="ot"> id=</span><span class="st">&quot;rate&quot;</span><span class="ot"> type=</span><span class="st">&quot;range&quot;</span><span class="ot"> min=</span><span class="st">&quot;0&quot;</span><span class="ot"> max=</span><span class="st">&quot;100&quot;</span><span class="ot"> data-width=</span><span class="st">&quot;40&quot;</span><span class="ot"> data-height=</span><span class="st">&quot;40&quot;</span><span class="ot"> data-angleOffset=</span><span class="st">&quot;220&quot;</span><span class="ot"> data-angleRange=</span><span class="st">&quot;280&quot;</span><span class="kw">&gt;</span>
          <span class="kw">&lt;label&gt;</span>Rate<span class="kw">&lt;/label&gt;</span>
        <span class="kw">&lt;/div&gt;</span>
        <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;knob&quot;</span><span class="kw">&gt;</span>
          <span class="kw">&lt;input</span><span class="ot"> id=</span><span class="st">&quot;int&quot;</span><span class="ot"> type=</span><span class="st">&quot;range&quot;</span><span class="ot"> min=</span><span class="st">&quot;0&quot;</span><span class="ot"> max=</span><span class="st">&quot;100&quot;</span><span class="ot"> data-width=</span><span class="st">&quot;40&quot;</span><span class="ot"> data-height=</span><span class="st">&quot;40&quot;</span><span class="ot"> data-angleOffset=</span><span class="st">&quot;220&quot;</span><span class="ot"> data-angleRange=</span><span class="st">&quot;280&quot;</span><span class="kw">&gt;</span>
          <span class="kw">&lt;label&gt;</span>Int.<span class="kw">&lt;/label&gt;</span>
        <span class="kw">&lt;/div&gt;</span>
      <span class="kw">&lt;/div&gt;</span>
    <span class="kw">&lt;/div&gt;</span>
    <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;panel&quot;</span><span class="kw">&gt;</span>
      <span class="kw">&lt;h2&gt;</span>VCF<span class="kw">&lt;/h2&gt;</span>
      <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;knobs&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;knob&quot;</span><span class="kw">&gt;</span>
          <span class="kw">&lt;input</span><span class="ot"> id=</span><span class="st">&quot;cutoff&quot;</span><span class="ot"> type=</span><span class="st">&quot;range&quot;</span><span class="ot"> min=</span><span class="st">&quot;0&quot;</span><span class="ot"> max=</span><span class="st">&quot;100&quot;</span><span class="ot"> data-width=</span><span class="st">&quot;40&quot;</span><span class="ot"> data-height=</span><span class="st">&quot;40&quot;</span><span class="ot"> data-angleOffset=</span><span class="st">&quot;220&quot;</span><span class="ot"> data-angleRange=</span><span class="st">&quot;280&quot;</span><span class="kw">&gt;</span>
          <span class="kw">&lt;label&gt;</span>Cutoff<span class="kw">&lt;/label&gt;</span>
        <span class="kw">&lt;/div&gt;</span>
        <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;knob&quot;</span><span class="kw">&gt;</span>
          <span class="kw">&lt;input</span><span class="ot"> id=</span><span class="st">&quot;peak&quot;</span><span class="ot"> type=</span><span class="st">&quot;range&quot;</span><span class="ot"> min=</span><span class="st">&quot;0&quot;</span><span class="ot"> max=</span><span class="st">&quot;100&quot;</span><span class="ot"> data-width=</span><span class="st">&quot;40&quot;</span><span class="ot"> data-height=</span><span class="st">&quot;40&quot;</span><span class="ot"> data-angleOffset=</span><span class="st">&quot;220&quot;</span><span class="ot"> data-angleRange=</span><span class="st">&quot;280&quot;</span><span class="kw">&gt;</span>
          <span class="kw">&lt;label&gt;</span>Peak<span class="kw">&lt;/label&gt;</span>
        <span class="kw">&lt;/div&gt;</span>
      <span class="kw">&lt;/div&gt;</span>
    <span class="kw">&lt;/div&gt;</span>
  <span class="kw">&lt;/div&gt;</span>
  <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;keyboard&quot;</span><span class="kw">&gt;&lt;/div&gt;</span>
<span class="kw">&lt;/div&gt;</span></code></pre>
<p>The <code>#brand</code>, <code>#controls</code>, and <code>#keyboard</code> divs correspond to the three main sections of the Monotron interface. Within the <code>#controls</code> div, we have four <code>.panel</code> divs: one for each of the horizontal control panels.</p>
<p>The first thing to do is style the <code>#monotron</code> container. As you can see, it’s mostly black, with white text and rounded white borders on the sides. That roughly translates to CSS like this:</p>
<pre class="sourceCode css"><code class="sourceCode css"><span class="fl">#monotron</span> <span class="kw">{</span>
  <span class="kw">background-color:</span> <span class="dt">#212121</span><span class="kw">;</span>
  <span class="kw">border-left:</span> <span class="dt">1rem</span> <span class="dt">solid</span> <span class="dt">#eaeeef</span><span class="kw">;</span>
  <span class="kw">border-right:</span> <span class="dt">1rem</span> <span class="dt">solid</span> <span class="dt">#eaeeef</span><span class="kw">;</span>
  <span class="kw">border-radius:</span> <span class="dt">0.38196601065988556rem</span><span class="kw">;</span>
  <span class="kw">padding:</span> <span class="dt">1.61803399rem</span><span class="kw">;</span>
  <span class="kw">font-family:</span> <span class="st">&quot;Source Sans Pro&quot;</span>, Arial, <span class="dt">sans-serif</span><span class="kw">;</span>
  <span class="kw">color:</span> <span class="dt">#eaeeef</span><span class="kw">;</span>
  <span class="kw">width:</span> <span class="dt">40rem</span><span class="kw">;</span>
<span class="kw">}</span></code></pre>
<p>So we don’t use exactly <code>#000</code> and <code>#fff</code> for the colors. I used <a href="http://www.veign.com/application.php?appid=107">Pixeur</a> on the Monotron photo above to pick the right colors. The other thing you’ll notice about this CSS is the units. Lately I’ve been using rems (root ems) instead of px when designing. rems are resolution-independent units which means this design will scale perfectly on any screen, regardless of DPI. You’ll also notice that I’ve specified the measurements as powers of <em>phi</em> (the golden ratio)<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a>. I’m not sure if this actually makes things look better, but it’s a lot easier than having to worry about individual pixels when laying things out.</p>
<p>Next, let’s style the <code>#brand</code> div. I’m using the <a href="http://www.google.com/fonts/specimen/Audiowide">Audiowide</a> font for the Monotron logo.</p>
<pre class="sourceCode css"><code class="sourceCode css">h1, h2, h3 <span class="kw">{</span>
  <span class="kw">font-family:</span> <span class="st">&quot;Audiowide&quot;</span>, Arial, <span class="dt">sans-serif</span><span class="kw">;</span>
  <span class="kw">margin:</span> <span class="dt">0</span><span class="kw">;</span>
  <span class="kw">font-weight:</span> <span class="dt">normal</span><span class="kw">;</span>
<span class="kw">}</span>

<span class="fl">#brand</span> <span class="kw">{</span>
  <span class="kw">margin-bottom:</span> <span class="dt">1.61803399rem</span><span class="kw">;</span>
<span class="kw">}</span>

<span class="fl">#title</span> <span class="kw">{</span>
  <span class="kw">font-size:</span> <span class="dt">2.6180339927953202rem</span><span class="kw">;</span>
  <span class="kw">text-transform:</span> <span class="dt">lowercase</span><span class="kw">;</span>
  <span class="kw">letter-spacing:</span> <span class="dt">0.05em</span><span class="kw">;</span>
<span class="kw">}</span>

<span class="fl">#description</span> <span class="kw">{</span>
  <span class="kw">text-transform:</span> <span class="dt">uppercase</span><span class="kw">;</span>
  <span class="kw">font-weight:</span> <span class="dt">bold</span><span class="kw">;</span>
<span class="kw">}</span></code></pre>
<p>We space the letters out just a bit so that the description is the same width as the title, just like on the real Monotron.</p>
<p>The next thing we need to do is lay out the control panels. The best tool for this job is the <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/CSS/Flexible_boxes">flexbox layout mode</a>. If you’re not familiar with flexbox, it’s a new layout mode in CSS3 that automatically adapts to the number of columns or rows you have. Basically, it renders CSS layout frameworks obsolete. The main downside is that there’s no standard CSS directive for enabling it yet. I used <a href="http://lesscss.org/">LESS</a> and <a href="https://gist.github.com/jayj/4012969">this Gist</a> to take care of the prefixes for me.</p>
<pre class="sourceCode css"><code class="sourceCode css"><span class="fl">#controls</span> <span class="kw">{</span>
  <span class="er">.flex-display;</span>

  <span class="er">.panel</span> <span class="er">{</span>
    <span class="kw">padding:</span> @size-base<span class="kw">;</span>
    <span class="er">.flex(1);</span>

    <span class="er">h2</span> <span class="er">{</span>
      <span class="kw">text-align:</span> <span class="dt">center</span><span class="kw">;</span>
      <span class="kw">margin-bottom:</span> @size-base<span class="kw">;</span>
    <span class="kw">}</span>

    label <span class="kw">{</span>
      <span class="kw">text-transform:</span> <span class="dt">lowercase</span><span class="kw">;</span>
      <span class="kw">font-weight:</span> <span class="dt">bold</span><span class="kw">;</span>
    <span class="kw">}</span>

    <span class="fl">.knobs</span> <span class="kw">{</span>
      <span class="er">.flex-display;</span>

      <span class="er">.knob</span> <span class="er">{</span>
        <span class="er">.flex(1);</span>
        <span class="kw">text-align:</span> <span class="dt">center</span><span class="kw">;</span>

        <span class="er">div</span> <span class="er">{</span>
          <span class="kw">text-align:</span> <span class="dt">center</span><span class="kw">;</span>
          <span class="kw">width:</span> <span class="dt">100%</span> <span class="kw">!important;</span>
          <span class="kw">margin-bottom:</span> @size-small<span class="kw">;</span>
        <span class="kw">}</span>
      }
    }

    &amp;<span class="dv">:first-child</span> <span class="kw">{</span>
      <span class="kw">text-align:</span> <span class="dt">center</span><span class="kw">;</span>
      <span class="er">.flex-display;</span>
      <span class="er">.justify-content(center);</span>
      <span class="er">.align-items(flex-end);</span>

      <span class="er">select</span> <span class="er">{</span>
        <span class="kw">margin-bottom:</span> @size-small<span class="kw">;</span>
      <span class="kw">}</span>
    }
  }
}</code></pre>
<p>There’s a lot going on here, but most important is the <code>.flex(1);</code> directives. This tells the browser that each <code>.panel</code> should take up one column, and each column should take up equal space. No need to worry about manually specifying widths, floats, etc. – it’s all taken care of for you.</p>
<p>The knobs are also aligned with flexbox. In the VCO control panel, there’s only one knob, but since we’re using flexbox, it’s automatically aligned correctly.</p>
<p>Of course, we haven’t actually added the knobs yet. The most popular knob library is <a href="http://anthonyterrien.com/knob/">jQuery knob</a>, but actually, it’s not the best option. The best knob library is <a href="https://github.com/eskimoblood/jim-knopf">Jim Knopf</a>, which uses SVG instead of canvas. This has two advantages: it scales beautifully and it can be styled (mostly) with CSS. I ended up using a modified version of “preset 2”:</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="ot">Ui</span>.<span class="fu">P2</span> = <span class="kw">function</span>() {
};

<span class="ot">Ui</span>.<span class="ot">P2</span>.<span class="fu">prototype</span> = <span class="ot">Object</span>.<span class="fu">create</span>(<span class="ot">Ui</span>.<span class="fu">prototype</span>);

<span class="ot">Ui</span>.<span class="ot">P2</span>.<span class="ot">prototype</span>.<span class="fu">createElement</span> = <span class="kw">function</span>() {
  <span class="st">&quot;use strict&quot;</span>;
  <span class="ot">Ui</span>.<span class="ot">prototype</span>.<span class="ot">createElement</span>.<span class="fu">apply</span>(<span class="kw">this</span>, arguments);
  <span class="kw">this</span>.<span class="fu">addComponent</span>(<span class="kw">new</span> <span class="ot">Ui</span>.<span class="fu">Arc</span>({
    <span class="dt">arcWidth</span>: <span class="kw">this</span>.<span class="fu">width</span> / <span class="dv">10</span>
  }));

  <span class="kw">this</span>.<span class="fu">addComponent</span>(<span class="kw">new</span> <span class="ot">Ui</span>.<span class="fu">Pointer</span>(<span class="kw">this</span>.<span class="fu">merge</span>(<span class="kw">this</span>.<span class="fu">options</span>, {
    <span class="dt">type</span>: <span class="st">'Rect'</span>,
    <span class="dt">pointerWidth</span>: <span class="kw">this</span>.<span class="fu">width</span> / <span class="dv">10</span>
  })));

  <span class="kw">this</span>.<span class="fu">merge</span>(<span class="kw">this</span>.<span class="fu">options</span>, {<span class="dt">arcWidth</span>: <span class="kw">this</span>.<span class="fu">width</span> / <span class="dv">10</span>});
  <span class="kw">var</span> arc = <span class="kw">new</span> <span class="ot">Ui</span>.<span class="ot">El</span>.<span class="fu">Arc</span>(<span class="kw">this</span>.<span class="fu">options</span>);
  <span class="ot">arc</span>.<span class="fu">setAngle</span>(<span class="kw">this</span>.<span class="ot">options</span>.<span class="fu">anglerange</span>);
  <span class="kw">this</span>.<span class="ot">el</span>.<span class="ot">node</span>.<span class="fu">appendChild</span>(<span class="ot">arc</span>.<span class="fu">node</span>);
  <span class="kw">this</span>.<span class="ot">el</span>.<span class="ot">node</span>.<span class="fu">setAttribute</span>(<span class="st">&quot;class&quot;</span>, <span class="st">&quot;p2&quot;</span>);
};</code></pre>
<pre class="sourceCode css"><code class="sourceCode css"><span class="fl">.p2</span> path <span class="kw">{</span>
  <span class="kw">stroke:</span> <span class="dt">none</span><span class="kw">;</span>
  <span class="kw">fill:</span> @text-color<span class="kw">;</span>
  <span class="kw">stroke-weight:</span> <span class="dt">.1</span><span class="kw">;</span>
<span class="kw">}</span>

<span class="fl">.p2</span> path<span class="dv">:first-child</span> <span class="kw">{</span>
  <span class="kw">fill:</span> darken(@bg-color, <span class="dt">5%</span>)<span class="kw">;</span>
<span class="kw">}</span>

<span class="fl">.p2</span> rect <span class="kw">{</span>
  <span class="kw">fill:</span> @text-color<span class="kw">;</span>
<span class="kw">}</span></code></pre>
<p>And then initialize the knobs when the page is finished loading:</p>
<pre class="sourceCode coffee"><code class="sourceCode coffee">$ <span class="fu">-&gt;</span>
  $<span class="kw">(</span><span class="st">'.knob input'</span><span class="kw">).</span>each <span class="fu">(i, knob) -&gt;</span>
    knopf <span class="kw">=</span> <span class="kw">new</span> <span class="dt">Knob</span><span class="kw">(</span>knob<span class="kw">,</span> <span class="kw">new</span> <span class="dt">Ui.P2</span><span class="kw">())</span></code></pre>
<h2 id="the-ribbon-keyboard">The Ribbon Keyboard</h2>
<p>At this point, we’ve got the audio circuit and the control panel. The remaining component is the ribbon keyboard. Looking at the Monotron’s keyboard, my first instinct was to use canvas. However, canvas is not the right approach here, because it’s not scalable<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a>. I just used (dynamically-generated) HTML and CSS for the keyboard interface:</p>
<pre class="sourceCode coffee"><code class="sourceCode coffee">noteToFrequency <span class="kw">=</span> <span class="fu">(note) -&gt;</span>
  <span class="ot">Math</span><span class="kw">.</span>pow<span class="kw">(</span><span class="dv">2</span><span class="kw">,</span> <span class="kw">(</span>note <span class="kw">-</span> <span class="dv">69</span><span class="kw">)</span> <span class="kw">/</span> <span class="dv">12</span><span class="kw">)</span> <span class="kw">*</span> <span class="fl">440.0</span>

<span class="kw">class</span> <span class="dt">RibbonKeyboard</span>
  <span class="kw">constructor:</span> <span class="fu">(@$el, @monotron) -&gt;</span>
    <span class="dt">@minNote</span> <span class="kw">=</span> <span class="dv">57</span>
    $ul <span class="kw">=</span> $<span class="kw">(</span><span class="st">'&lt;ul&gt;'</span><span class="kw">)</span>
    <span class="kw">for</span> note <span class="kw">in</span> <span class="kw">[</span><span class="dv">1</span><span class="kw">..</span><span class="dv">18</span><span class="kw">]</span>
      $key <span class="kw">=</span> $<span class="kw">(</span><span class="st">'&lt;li&gt;'</span><span class="kw">)</span>
      <span class="kw">if</span> note <span class="kw">in</span> <span class="kw">[</span><span class="dv">2</span><span class="kw">,</span> <span class="dv">5</span><span class="kw">,</span> <span class="dv">7</span><span class="kw">,</span> <span class="dv">10</span><span class="kw">,</span> <span class="dv">12</span><span class="kw">,</span> <span class="dv">14</span><span class="kw">,</span> <span class="dv">17</span><span class="kw">]</span>
        $key<span class="kw">.</span>addClass <span class="st">'accidental'</span>
        $key<span class="kw">.</span>width <span class="kw">(</span><span class="dt">@$el</span><span class="kw">.</span>width<span class="kw">()</span> <span class="kw">/</span> <span class="dv">20</span><span class="kw">)</span>
        $key<span class="kw">.</span>css <span class="st">'left'</span><span class="kw">,</span> <span class="st">&quot;-</span><span class="ch">#{</span>$key.width() / 2<span class="ch">}</span><span class="st">px&quot;</span>
        $key<span class="kw">.</span>css <span class="st">'margin-right'</span><span class="kw">,</span> <span class="st">&quot;-</span><span class="ch">#{</span>$key.width()<span class="ch">}</span><span class="st">px&quot;</span>
      <span class="kw">else</span> <span class="kw">if</span> note <span class="kw">in</span> <span class="kw">[</span><span class="dv">1</span><span class="kw">,</span> <span class="dv">18</span><span class="kw">]</span>
        $key<span class="kw">.</span>width <span class="kw">(</span><span class="dt">@$el</span><span class="kw">.</span>width<span class="kw">()</span> <span class="kw">/</span> <span class="dv">20</span><span class="kw">)</span>
      <span class="kw">else</span>
        $key<span class="kw">.</span>width <span class="kw">(</span><span class="dt">@$el</span><span class="kw">.</span>width<span class="kw">()</span> <span class="kw">/</span> <span class="dv">10</span><span class="kw">)</span>
      $ul<span class="kw">.</span>append $key
    <span class="dt">@$el</span><span class="kw">.</span>append $ul

    <span class="dt">@mouseDown</span> <span class="kw">=</span> <span class="ot">false</span>
    $ul<span class="kw">.</span>mousedown <span class="fu">(e) =&gt;</span>
      <span class="dt">@mouseDown</span> <span class="kw">=</span> <span class="ot">true</span>
      <span class="dt">@click</span><span class="kw">(</span>e<span class="kw">)</span>
    $ul<span class="kw">.</span>mouseup <span class="fu">(e) =&gt;</span>
      <span class="dt">@mouseDown</span> <span class="kw">=</span> <span class="ot">false</span>
      <span class="dt">@monotron</span><span class="kw">.</span>noteOff<span class="kw">()</span>
    $ul<span class="kw">.</span>mousemove <span class="dt">@click</span>

  click<span class="kw">:</span> <span class="fu">(e) =&gt;</span>
    <span class="kw">return</span> <span class="kw">unless</span> <span class="dt">@mouseDown</span>
    offset <span class="kw">=</span>  e<span class="kw">.</span>pageX <span class="kw">-</span> <span class="dt">@$el</span><span class="kw">.</span>offset<span class="kw">().</span>left
    ratio <span class="kw">=</span> offset <span class="kw">/</span> <span class="dt">@$el</span><span class="kw">.</span>width<span class="kw">()</span>
    min <span class="kw">=</span> noteToFrequency <span class="dt">@minNote</span>
    max <span class="kw">=</span> noteToFrequency <span class="kw">(</span><span class="dt">@minNote</span> <span class="kw">+</span> <span class="dv">18</span><span class="kw">)</span>
    <span class="dt">@monotron</span><span class="kw">.</span>noteOn ratio <span class="kw">*</span> <span class="kw">(</span>max <span class="kw">-</span> min<span class="kw">)</span> <span class="kw">+</span> min</code></pre>
<p>Basically, the <code>RibbonKeyboard</code> constructor creates 18 keys, manually setting the right width for each one. If the note is a “white” (accidental) key, it adds the <code>.accidental</code> class and a negative margin so that it overlaps with the next key.</p>
<p>To emulate the Monotron’s ribbon keyboard, we listen for <code>mousedown</code>, <code>mouseup</code>, and <code>mousemove</code> events. This way, we can trigger new notes whenever the user drags the mouse across the keyboard.</p>
<p>The interesting thing here is the <code>click</code> event handler. It calculates where the user has clicked on the keyboard as a ratio between 0.0 and 1.0. It then rescales this into a musical frequency with the <code>noteToFrequency</code> function. By default, <code>@minNote</code> is set to 57, which means that C on the keyboard will correspond to middle C (MIDI note 60).</p>
<p>Now to make the keyboard look like the real thing, check out this CSS:</p>
<pre class="sourceCode css"><code class="sourceCode css"><span class="fl">#keyboard</span> <span class="kw">{</span>
  <span class="er">.</span><span class="kw">box-sizing</span><span class="er">(border-box);</span>
  <span class="er">.box-shadow(inset</span> <span class="er">0</span> <span class="er">0</span> <span class="er">@size-base</span> <span class="er">fade(@text-color,</span> <span class="er">10%));</span>
  <span class="er">background-color</span><span class="kw">:</span> darken(@bg-color, <span class="dt">8%</span>)<span class="kw">;</span>
  <span class="kw">border-left:</span> @size-base <span class="dt">solid</span> lighten(@bg-color, <span class="dt">10%</span>)<span class="kw">;</span>
  <span class="kw">border-right:</span> @size-base <span class="dt">solid</span> lighten(@bg-color, <span class="dt">10%</span>)<span class="kw">;</span>
  <span class="kw">border-top:</span> @size-base <span class="dt">solid</span> darken(@bg-color, <span class="dt">5%</span>)<span class="kw">;</span>
  <span class="kw">border-bottom:</span> @size-base <span class="dt">solid</span> lighten(@bg-color, <span class="dt">5%</span>)<span class="kw">;</span>
  <span class="kw">height:</span> <span class="dt">7rem</span><span class="kw">;</span>

  <span class="er">ul</span> <span class="er">{</span>
    <span class="kw">margin:</span> <span class="dt">0</span><span class="kw">;</span>
    <span class="kw">padding:</span> <span class="dt">0</span><span class="kw">;</span>
    <span class="kw">list-style:</span> <span class="dt">none</span><span class="kw">;</span>
    <span class="kw">width:</span> <span class="dt">100%</span><span class="kw">;</span>
    <span class="kw">height:</span> <span class="dt">100%</span><span class="kw">;</span>

    <span class="er">li</span> <span class="er">{</span>
      <span class="kw">float:</span> <span class="dt">left</span><span class="kw">;</span>
      <span class="kw">height:</span> <span class="dt">100%</span><span class="kw">;</span>
      <span class="kw">border-right:</span> <span class="dt">1px</span> <span class="dt">solid</span> @text-color<span class="kw">;</span>
      <span class="kw">position:</span> <span class="dt">relative</span><span class="kw">;</span>
      <span class="er">.</span><span class="kw">box-sizing</span><span class="er">(border-box);</span>

      <span class="er">&amp;.accidental</span> <span class="er">{</span>
        <span class="er">background-color</span><span class="kw">:</span> @text-color<span class="kw">;</span>
        <span class="kw">height:</span> <span class="dt">70%</span><span class="kw">;</span>
      <span class="kw">}</span>

      &amp;<span class="dv">:last-child</span> <span class="kw">{</span>
        <span class="kw">border:</span> <span class="dt">none</span><span class="kw">;</span>
      <span class="kw">}</span>
    }
  }
}</code></pre>
<p>The cool thing here is the border around the keyboard, which makes it look like the Monotron has some depth. When you specify thick borders of different colors, they intersect at a 45 degree angle. With the right shades of grey, we can create a fake 3D effect.</p>
<div class="figure">
<img src="https://lh3.googleusercontent.com/-KZdscuCzv1g/Uf8XeC1r_BI/AAAAAAAAxwA/9Ug5scl7TUI/s0/Capture2.jpg" alt="Fake 3D with CSS Borders" /><p class="caption">Fake 3D with CSS Borders</p>
</div>
<h2 id="connecting-the-components">Connecting the Components</h2>
<p>Now we have all of the components we need to build a Monotron: the audio circuit, the control panel, and the keyboard. The only thing that remains is connecting these components together. First, let’s set up the audio and the keyboard:</p>
<pre class="sourceCode coffee"><code class="sourceCode coffee">$ <span class="fu">-&gt;</span>
  audioContext <span class="kw">=</span> <span class="kw">new</span> (<span class="dt">AudioContext</span> <span class="kw">?</span> webkitAudioContext<span class="kw">)()</span>
  window<span class="kw">.</span>monotron <span class="kw">=</span> <span class="kw">new</span> <span class="dt">Monotron</span><span class="kw">(</span>audioContext<span class="kw">)</span>
  masterGain <span class="kw">=</span> audioContext<span class="kw">.</span>createGain<span class="kw">()</span>
  masterGain<span class="kw">.</span>gain<span class="kw">.</span>value <span class="kw">=</span> <span class="fl">0.7</span> <span class="co"># to prevent clipping</span>
  masterGain<span class="kw">.</span>connect audioContext<span class="kw">.</span>destination
  monotron<span class="kw">.</span>connect masterGain

  keyboard <span class="kw">=</span> <span class="kw">new</span> <span class="dt">RibbonKeyboard</span><span class="kw">(</span>$<span class="kw">(</span><span class="st">'#keyboard'</span><span class="kw">),</span> monotron<span class="kw">)</span></code></pre>
<p>We create a new <code>AudioContext</code> (keeping in mind that current browsers name it differently), a new <code>Monotron</code> audio circuit, and the <code>masterGain</code> node. The <code>masterGain</code> node is important because it prevents the audio from exceeding the maximum value of +/-1.0. If the audio did exceed +/-1.0, it would result in distortion known as <em>clipping</em>. After connecting these nodes together, we create a new <code>RibbonKeyboard</code> and connect it to the audio circuit.</p>
<p>Now you should be able to play some notes with the keyboard. Right now, the sound isn’t so hot. To fix that, we need to hook up the control panel. There’s one complication: audio parameters should be adjusted on a logarithmic scale (because that’s how our ears work), but the knobs only provide a linear scale. We’ll need to override the knobs’ <code>.changed</code> method to accomodate this:</p>
<pre class="sourceCode coffee"><code class="sourceCode coffee">  <span class="co"># ... rest of $(document).ready callback ...</span>
  params <span class="kw">=</span>
    rate<span class="kw">:</span>
      param<span class="kw">:</span> monotron<span class="kw">.</span>lfo<span class="kw">.</span>frequency
      min<span class="kw">:</span> <span class="fl">0.001</span>
      max<span class="kw">:</span> <span class="fl">900.0</span>
      scale<span class="kw">:</span> <span class="fl">1.1</span>
    int<span class="kw">:</span>
      param<span class="kw">:</span> monotron<span class="kw">.</span>lfoGain<span class="kw">.</span>gain
      min<span class="kw">:</span> <span class="fl">0.5</span>
      max<span class="kw">:</span> <span class="fl">500.0</span>
    cutoff<span class="kw">:</span>
      param<span class="kw">:</span> monotron<span class="kw">.</span>vcf<span class="kw">.</span>frequency
      min<span class="kw">:</span> <span class="fl">0.001</span>
      max<span class="kw">:</span> <span class="fl">900.0</span>
      scale<span class="kw">:</span> <span class="fl">1.03</span>
    peak<span class="kw">:</span>
      param<span class="kw">:</span> monotron<span class="kw">.</span>vcf<span class="kw">.</span>Q
      min<span class="kw">:</span> <span class="fl">0.001</span>
      max<span class="kw">:</span> <span class="fl">1000.0</span>
      scale<span class="kw">:</span> <span class="fl">1.10</span>

  knopfs <span class="kw">=</span> <span class="kw">[]</span>
  $<span class="kw">(</span><span class="st">'.knob input'</span><span class="kw">).</span>each <span class="fu">(i, knob) -&gt;</span>
    knopf <span class="kw">=</span> <span class="kw">new</span> <span class="dt">Knob</span><span class="kw">(</span>knob<span class="kw">,</span> <span class="kw">new</span> <span class="dt">Ui.P2</span><span class="kw">())</span>
    knopfs<span class="kw">.</span>push knopf
    param <span class="kw">=</span> params<span class="kw">[</span>knob<span class="kw">.</span>id<span class="kw">]</span>
    <span class="kw">if</span> param<span class="kw">?</span>
      knopf<span class="kw">.</span>changed <span class="kw">=</span> <span class="fu">-&gt;</span>
        Knob<span class="kw">.</span>prototype<span class="kw">.</span>changed<span class="kw">.</span>apply <span class="dt">this</span><span class="kw">,</span> arguments
        <span class="co"># convert to log scale</span>
        scale <span class="kw">=</span> param<span class="kw">.</span>scale <span class="kw">?</span> <span class="fl">1.05</span>
        ratio <span class="kw">=</span> <span class="ot">Math</span><span class="kw">.</span>pow<span class="kw">(</span>scale<span class="kw">,</span> <span class="dt">@value</span><span class="kw">)</span> <span class="kw">/</span> <span class="ot">Math</span><span class="kw">.</span>pow<span class="kw">(</span>scale<span class="kw">,</span> <span class="dt">@settings</span><span class="kw">.</span>max<span class="kw">)</span>
        value <span class="kw">=</span> ratio <span class="kw">*</span> <span class="kw">(</span>param<span class="kw">.</span>max <span class="kw">-</span> param<span class="kw">.</span>min<span class="kw">)</span> <span class="kw">+</span> param<span class="kw">.</span>min
        param<span class="kw">.</span>param<span class="kw">.</span>setValueAtTime value<span class="kw">,</span> audioContext<span class="kw">.</span>currentTime
    <span class="kw">else</span> <span class="kw">if</span> knob<span class="kw">.</span>id <span class="kw">==</span> <span class="st">&quot;pitch&quot;</span>
      knopf<span class="kw">.</span>changed <span class="kw">=</span> <span class="fu">-&gt;</span>
        Knob<span class="kw">.</span>prototype<span class="kw">.</span>changed<span class="kw">.</span>apply <span class="dt">this</span><span class="kw">,</span> arguments
        keyboard<span class="kw">.</span>minNote <span class="kw">=</span> <span class="ot">parseInt</span> <span class="dt">@value</span></code></pre>
<p>So first we define a data structure that specifies which <code>AudioParam</code> the knob should control, the range of possible values, and how sensitive the knob is. Then when we initialize the knob, we override the <code>.changed</code> callback to actually change the corresponding <code>AudioParam</code>.</p>
<p>The pitch knob isn’t controlling an <code>AudioParam</code>, so it’s a special case. It adjusts the minimum note on the keyboard.</p>
<p>Next we’ll hook up the modulation router. If it’s set to “Standby”, the LFO will be disabled. Otherwise, the LFO will modulate either the VCO frequency (“Pitch”) or the VCF cutoff frequency (“Cutoff”).</p>
<pre class="sourceCode coffee"><code class="sourceCode coffee">  <span class="co"># ... rest of $(document).ready callback ...</span>
  $<span class="kw">(</span><span class="st">'#mod'</span><span class="kw">).</span>change <span class="fu">(e) -&gt;</span>
    target <span class="kw">=</span> $<span class="kw">(</span><span class="dt">this</span><span class="kw">).</span>find<span class="kw">(</span><span class="st">&quot;:selected&quot;</span><span class="kw">).</span>val<span class="kw">()</span>
    monotron<span class="kw">.</span>lfoGain<span class="kw">.</span>disconnect<span class="kw">()</span>
    <span class="kw">if</span> target <span class="kw">is</span> <span class="st">&quot;Pitch&quot;</span>
      monotron<span class="kw">.</span>lfoGain<span class="kw">.</span>connect monotron<span class="kw">.</span>vco<span class="kw">.</span>frequency
    <span class="kw">else</span> <span class="kw">if</span> target <span class="kw">is</span> <span class="st">&quot;Cutoff&quot;</span>
      monotron<span class="kw">.</span>lfoGain<span class="kw">.</span>connect monotron<span class="kw">.</span>vcf<span class="kw">.</span>frequency</code></pre>
<p>Finally, we’ll specify the initial “patch” – that is, the default Monotron parameters:</p>
<pre class="sourceCode coffee"><code class="sourceCode coffee">  <span class="co"># ... rest of $(document).ready callback ...</span>
  <span class="co"># the initial &quot;patch&quot;</span>
  $<span class="kw">(</span><span class="st">&quot;#pitch&quot;</span><span class="kw">).</span>val <span class="dv">57</span>
  $<span class="kw">(</span><span class="st">&quot;#rate&quot;</span><span class="kw">).</span>val <span class="dv">46</span>
  $<span class="kw">(</span><span class="st">&quot;#int&quot;</span><span class="kw">).</span>val <span class="dv">97</span>
  $<span class="kw">(</span><span class="st">&quot;#cutoff&quot;</span><span class="kw">).</span>val <span class="dv">72</span>
  $<span class="kw">(</span><span class="st">&quot;#peak&quot;</span><span class="kw">).</span>val <span class="dv">57</span>
  $<span class="kw">(</span><span class="st">&quot;#mod&quot;</span><span class="kw">).</span>val <span class="st">&quot;Pitch&quot;</span>

  knopfs<span class="kw">.</span>forEach <span class="fu">(knopf) -&gt;</span>
    knopf<span class="kw">.</span>changed <span class="dv">0</span></code></pre>
<p>The last thing is to manually call the <code>.changed</code> method on the knobs so that the synth updates with the new values. Hopefully, you now have <a href="http://noisehack.com/monotron/">something like this</a>!</p>
<h2 id="conclusion">Conclusion</h2>
<p>Alright, at this point you’ve learned how to build a Monotron in Javascript. However, if you’ve used <a href="http://www.amazon.com/dp/B003DX96TW/?tag=zacden-20">a real Monotron</a>, you may be a bit disappointed with the way this one sounds. The reason is because the real Monotron uses an <a href="http://www.amazon.com/dp/B00B5SKWBS/?tag=zacden-20">MS-20</a> analog filter. This filter has a signature resonance that just isn’t there when using the Web Audio API’s <code>BiquadFilter</code>. However, all is not lost. The analog filter can be emulated with a custom <code>ScriptProcessorNode</code>, and I’ll show you how to do this in an upcoming post.</p>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Normally, I would have the noteOn method accept a MIDI note number as its required parameter, but since the Monotron’s ribbon keyboard doesn’t do separate notes, I decided the noteOn method should just accept the raw frequency.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>I use LESS to <a href="https://github.com/zacharydenton/monotron/blob/master/css/preboot.less#L45">calculate this automatically</a>.<a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>Canvas isn’t scalable by default, but if you redraw whenever the window is resized, you can make it seem like it is.<a href="#fnref3">↩</a></p></li>
</ol>
</div>
  <hr />
  <p>If you enjoyed this post, subscribe to the <a target="_blank" href="http://feedburner.google.com/fb/a/mailverify?uri=noisehack&loc=en_US">Noisehack newsletter</a> or <a href="https://twitter.com/noisehack">follow us on Twitter</a>.
  </p>
  <hr />
  <div id="disqus_thread"></div>
  <script type="text/javascript">
  var disqus_shortname = 'noisehack';
  (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  </script>
</article>

		<aside id="sidebar">
<h2>Subscribe</h2>
<ul>
  <li><a href="http://feedburner.google.com/fb/a/mailverify?uri=noisehack&loc=en_US"><i class="icon-envelope"></i> Newsletter</a></li>
  <li><a href="https://twitter.com/noisehack"><i class="icon-twitter"></i> Twitter</a></li>
  <li><a href="http://feeds.feedburner.com/noisehack"><i class="icon-rss"></i> RSS</a></li>
</ul>
<h2>Recent</h2>
<ul class="recent">
  
  <li><a href="../custom-audio-effects-javascript-web-audio-api/"><i class="icon-asterisk"></i> Custom Audio Effects in JavaScript with the Web Audio API</a></li>
  
  <li><a href="../how-to-build-monotron-synth-web-audio-api/"><i class="icon-asterisk"></i> How to Build a Monotron Synth with the Web Audio API</a></li>
  
  <li><a href="../generate-noise-web-audio-api/"><i class="icon-asterisk"></i> How to Generate Noise with the Web Audio API</a></li>
  
</ul>
</aside>


		<footer>
<p>
Noisehack is brought to you by <a href="http://zacharydenton.com/">Zach Denton</a>.
</p>
<p>
Grab <a href="http://feeds.feedburner.com/noisehack">the RSS feed</a> or <a href="https://twitter.com/noisehack">follow Noisehack on Twitter</a>.
</p>
</footer>

		</div>
	</body>
</html>
