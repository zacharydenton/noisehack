<!doctype html>
<html lang="en-us">
	<head>
		<meta charset="utf-8">
		<title>Build a Media Server With Ampache and Transmission</title>
		<meta name="description" content="A guide to building the ultimate music server using open source software.">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="canonical" href="http://noisehack.com/build-a-media-server-with-ampache-and-transmission/">
		<link href="http://fonts.googleapis.com/css?family=Iceberg|Source+Sans+Pro:400,700,400italic,700italic" rel="stylesheet" type="text/css">
		<link rel="stylesheet" href="../css/main.css">
	</head>
	<body>
		<header role="banner">
			<h1><a href="../">Noisehack</a></h1>
			<nav>
			<ul>
				<li><a href="../about/">About</a></li>
				<li><a href="../archives/">Archives</a></li>
				<li><a href="http://feeds.feedburner.com/noisehack">RSS</a></li>
				<li><a href="https://twitter.com/noisehack">Twitter</a></li>
			</ul>
			</nav>
		</header>

		<div id="container">
		<article>
  <h1>Build a Media Server With Ampache and Transmission</h1>
  <p>This guide will teach you how to unleash your music collection. Access it from anywhere with an internet connection – on your laptop, your phone, at work, or on a plane.</p>
<p>This guide has three parts. Part one tells you how to build a server for less than $300. Part two discusses how to build a music collection. Part three discusses how to stream that collection across the internet. <!--more--></p>
<p>If you already have a computer that is connected to the Internet 24/7, you can skip part one.</p>
<h2 id="part-one-building-a-server">Part One: Building a Server</h2>
<p>We will need a computer to use as the server. You have three options here:</p>
<ol style="list-style-type: decimal">
<li>Re-use an old computer. The cheapest option.</li>
<li>Purchase a new computer. The easiest option.</li>
<li>Build a new computer. The educational option.</li>
<li>Purchase a <abbr title="Virtual private server">VPS</abbr>. Potentially the best option, with a few caveats (<a href="#vps-note">more details below</a>).</li>
</ol>
<p>If you chose option 3, read the following section. Otherwise you can skip past it.</p>
<h3 id="building-a-new-computer">Building a new computer</h3>
<p>The first thing to do when building a new computer is to come up with a parts list. It turns out that there are only six things you need to build a computer:</p>
<ul>
<li>CPU (aka processor)</li>
<li>Motherboard</li>
<li>RAM (aka memory)</li>
<li>Storage drive(s)</li>
<li>Power supply</li>
<li>Case</li>
</ul>
<p>Seasoned builders will be quick to point that there are a plethora of additional parts that can be used to build a computer. Expert builders will be even quicker to point out that you don’t even need a case or storage drives. For the purposes of this guide, however, I will focus on the six aforementioned parts. What follows is a list of the six parts I used to build my media server. They will most likely be out of date by the time you read this – just use them as an example.</p>
<h4 id="cpu-amd-athlon-ii-x2-250-60.99">CPU: AMD Athlon II X2 250 ($60.99)</h4>
<p>You don’t need a super-powerful processor in your server. That said, this processor packs an astonishing punch at 60 bucks.</p>
<h4 id="motherboard-gigabyte-ga-ma74gm-s2-740g-54.99">Motherboard: Gigabyte GA-MA74GM-S2 740G ($54.99)</h4>
<p>I’m really pleased with this motherboard. It’s very small (Micro ATX), yet it comes with a ton of features like onboard video, gigabit ethernet, sound, and the ability to upgrade to a discrete graphics card if desired.</p>
<p>If you use this motherboard (or similar), your media server will be able to perform double-duty as a media center if you hook it up to your TV. Expect to see another guide explaining how to do this in the future.</p>
<h4 id="ram-a-data-2gb-ddr2-800-32.99">RAM: A-DATA 2GB DDR2-800 ($32.99)</h4>
<p>Just some basic, cheap DDR2 RAM. Works well (did I mention it was cheap?).</p>
<h4 id="storage-drive-samsung-spinpoint-f4-2tb-5400-rpm-79.99">Storage drive: Samsung Spinpoint F4 2TB 5400 RPM ($79.99)</h4>
<p>You’re going to want a large drive in your media server to store your music collection. 2TB for 80 bucks is just an incredible deal. Less than three years ago I paid the same price for 10% of that.</p>
<h4 id="power-supply-logisys-575w-24.99">Power supply: Logisys 575W ($24.99)</h4>
<p>Normally I use high-end power supplies when building computers, so I was a bit wary of using this $25 power supply. It was substantially lighter than I am used to (heftier power supplies are typically higher-quality), but so far it has performed admirably.</p>
<h4 id="case-apex-tx-381-c-micro-atx-tower-29.99">Case: Apex TX-381-C Micro ATX Tower ($29.99)</h4>
<p>It’s a solid case. Very inexpensive. Somewhat loud.</p>
<p>That’s a grand total of around 280 bucks for a great server. Today you can probably get an even better machine for the same price or less.</p>
<p>Once you have all of the parts, you will need to put them together. Check out <a href="http://en.wikibooks.org/wiki/How_To_Assemble_A_Desktop_PC">How To Assemble A Desktop PC</a>, a great wikibook teaching you how to do that.</p>
<h3 id="setting-up-the-server">Setting up the server</h3>
<p>Now that you have a machine to use as your media server, you will need to install Linux on it. The version (or “distro”) I recommend is Ubuntu Server Edition. Take a look at the <a href="https://help.ubuntu.com/10.10/serverguide/C/index.html">Ubuntu Server Guide</a>. which will teach you everything you need to know.</p>
<p>You’re going to want to set up SSH access to your machine so that you can manage it remotely. You can find the details in the <a href="https://help.ubuntu.com/10.10/serverguide/C/openssh-server.html">OpenSSH section of the Ubuntu Server Guide</a>.</p>
<p>The final thing you need to do is to hook your new server up to the Internet. For streaming 320kbps music files, I recommend having a minimum upload bandwidth of around 384kbps (50KB/s). That’s what I used to have, and occasionally I had to reduce the streaming rate to 192kbps to eliminate stuttering. Miraculously my ISP increased my upload bandwidth to around 1mbps, for free (as far as I know). That’s more than enough for streaming music.</p>
<h3 id="vps-note">
A note on VPSs
</h3>
<p>If you opt to use a VPS, you don’t have to worry about setting up a Linux server with a 24/7 high speed internet connection. What you do need to worry about is violating your hosting provider’s Terms of Service. They may not appreciate you downloading and streaming music on their servers.</p>
<p>The other thing is that you likely won’t have unlimited disk space, even if you do have “Unlimited Disk Space!”. I would think twice before uploading a 400GB FLAC collection to a VPS.</p>
<p>If you can deal with these two conditions, then using your VPS as a media server is probably the best way to go. You get an extremely fast connection and you don’t have to worry as much about maintaining the server.</p>
<h2 id="part-two-building-a-music-collection">Part Two: Building a music collection</h2>
<p>What good is a music server without any music? That’s a problem that this section of the guide intends to solve. There are a lot of ways to get music these days: iTunes, purchasing directly from the artist, BitTorrent, and even purchasing from a store. For simplicity, I’m just going to focus on BitTorrent. If you don’t know what BitTorrent is, you may want to read <a href="http://www.bittorrent.org/introduction.html">this introduction</a> first.</p>
<p>This section of the guide will teach you how to access and use the best music repositories in the world (for free).</p>
<h3 id="installing-the-bittorrent-client">Installing the BitTorrent client</h3>
<p>You may be familiar with Transmission – it’s an excellent, easy-to-use BitTorrent client for Windows, Mac, and Linux. Transmission can also run in the background, as a daemon. This is called <code>transmission-daemon</code>. <code>transmission-daemon</code> comes with a beautiful web interface which you will be using to manage your torrents from anywhere in the world.</p>
<p>To install <code>transmission-daemon</code> on Ubuntu, ssh into your server and type the following:</p>
<pre class="console"><code>$ sudo aptitude install transmission-daemon</code></pre>
<p>First we make sure that <code>transmission-daemon</code> is not running:</p>
<pre class="console"><code>$ sudo /etc/init.d/transmission-daemon stop</code></pre>
<p>Now you want to configure <code>transmission-daemon</code>, so do:</p>
<pre class="console"><code>$ sudo $EDITOR /etc/transmission-daemon/settings.json</code></pre>
<p>You want to make the following changes:</p>
<pre class="js"><code>&quot;rpc-whitelist-enabled&quot;: false,
&quot;rpc-username&quot;: &quot;your-username&quot;,
&quot;rpc-password&quot;: &quot;your-password&quot;,</code></pre>
<p>This allows you to access <code>transmission-daemon</code> remotely, as long as you specify the correct username and password.</p>
<p>Finally, we restart <code>transmission-daemon</code>:</p>
<pre class="console"><code>$ sudo /etc/init.d/transmission-daemon start</code></pre>
<p>Now you can log in to the <code>transmission-daemon</code> web interface by pointing your web browser to http://your-server:9091/. Once you’ve logged in, you should see a nice interface where you can manage torrents and edit preferences. This is how you’ll be interacting with <code>transmission-daemon</code> most of the time.</p>
<p>What we need now is some torrents to download!</p>
<h3 id="finding-music-for-your-collection">Finding music for your collection</h3>
<p>I usually find new music based on recommendations from friends or Last.fm. Last.fm is a service which monitors your listening habits and then provides recommendations based on that data. It’s pretty cool, and it makes it easier to answer “So, what kind of music do you like?” with something other than “Oh, I listen to a little bit of everything.”.</p>
<p>Once you have some candidates for adding to your collection, you need to actually get your hands on the files. To do this, we use a BitTorrent search engine. The three that I use are (ranked from decent to best):</p>
<ul>
<li>The Pirate Bay</li>
<li>Demonoid</li>
<li>What.CD</li>
</ul>
<h4 id="the-pirate-bay">The Pirate Bay</h4>
<p>Most BitTorrent users will be familiar with The Pirate Bay. It’s one of the largest BitTorrent sites and certainly the most infamous. They offer a fair amount of music, probably enough for the casual user. There are no real quality standards here so you may have to search a bit before finding the good stuff. The Pirate Bay does not require registration.</p>
<h4 id="demonoid">Demonoid</h4>
<p>Demonoid is similar to The Pirate Bay in that it offers a wide range of content. I often find that if something isn’t on TPB, it’s on Demonoid (and vice versa). Demonoid requires registration, but it’s not difficult to get in.</p>
<h4 id="what.cd">What.CD</h4>
<p>What.CD is the holy grail for music enthusiasts. It is indisputably the greatest music collection ever assembled. If you’re lucky enough to get in, you will have access to pretty much every release of every album in any format you could want. They maintain their high quality by maintaining a high quality userbase, so if you want to get in you have two options: get an invite or pass an interview.</p>
<h3 id="a-brief-digression-on-formats">A brief digression on formats</h3>
<p>There are two kinds of music formats: lossy and lossless.</p>
<p>MP3, AAC, and OGG are all lossy formats, meaning that they discard some of the audio data in order to achieve smaller file sizes. Lossy formats are prevalent on public trackers like The Pirate Bay.</p>
<p>FLAC is a lossless format, meaning that it preserves all of the original audio data. As you build your music collection, you will learn more and more about FLAC. My collection consists solely of FLACs. One cool thing about FLAC that relates to this guide is that you can convert it to a lossy format on-the-fly for streaming over the internet – useful if you have a slow connection.</p>
<h2 id="part-three-serving-your-music-collection-over-the-internet">Part three: Serving your music collection over the Internet</h2>
<p>To stream your music over the Internet we will be using something called Ampache. The name is a portmanteau of the words Amp (as in amplifier) and Apache (the prominent web server).</p>
<p>Ampache provides a web interface to your music collection. You use the interface to create playlists. The playlists can then be played in the browser or opened in your favorite standalone media player. There are also Ampache clients for Android and iPhone, so you can access your full music collection on your phone. Additionally, Ampache can transcode your music on-the-fly to any format (useful for streaming to devices with slower internet connections).</p>
<h3 id="installing-ampache">Installing Ampache</h3>
<p>Ampache is included in the Ubuntu repositories. Just do:</p>
<pre class="console"><code>$ sudo aptitude install ampache mysql-server</code></pre>
<p>And the required programs will be installed for you. When asked which web server to configure automatically, select apache2. When asked to restart the web server, select “Yes”. Choose the root password for your MySQL server and remember it.</p>
<p>At this point, try navigating to http://your-server/ampache/. If the page is not found, do the following:</p>
<pre class="console"><code>$ sudo $EDITOR /etc/apache2/apache2.conf</code></pre>
<p>Add the following to the bottom of that file:</p>
<pre class="sourceCode apache"><code class="sourceCode apache">Include<span class="st"> /etc/ampache/ampache.conf</span></code></pre>
<p>Restart the web server:</p>
<pre class="console"><code>$ sudo /etc/init.d/apache2 restart</code></pre>
<p>Now, open http://your-server/ampache/ in a web browser. You will see a webpage entitled ‘Ampache Installation’. Click on ‘Start configuration’ near the bottom of the page.</p>
<p>On the next page, enter the MySQL root password in the ‘MySQL Administrative Password’ box. Then click ‘Insert Database’.</p>
<p>On this page, type ‘root’ into the ‘MySQL Username’ box. The ‘MySQL username’ is the MySQL root password you entered on the previous page. Click ‘Write Config’ and you will be prompted to download an <code>ampache.cfg.php</code> file. Save this file to your local machine.</p>
<h3 id="configuring-ampache">Configuring Ampache</h3>
<p>Make the following changes to <code>ampache.cfg.php</code>:</p>
<pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="fu">xml_rpc:</span> &quot;true&quot;
<span class="fu">allow_zip_download:</span> &quot;true&quot;
<span class="fu">transcode_m4a:</span> &quot;false&quot;</code></pre>
<p>If you would like to transcode your FLACs on-the-fly, make the following change:</p>
<pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="fu">transcode_flac:</span> &quot;true&quot;</code></pre>
<p>If you have multiple formats of each album (e.g. if you download albums in MP3, OGG, AAC, and FLAC), each format will be indexed. To eliminate these duplicates, you can opt to only index one of these formats. To only index FLAC:</p>
<pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="fu">catalog_file_pattern:</span> &quot;flac&quot;</code></pre>
<p>When you’ve finished editing <code>ampache.cfg.php</code>, copy it to the <code>/etc/ampache</code> directory on your server:</p>
<pre class="console"><code>$ scp /path/to/ampache.cfg.php root@your-server:/etc/ampache/</code></pre>
<p>Once <code>ampache.cfg.php</code> is in place on your server, click ‘Check for Config’. Both ‘Ampache.cfg.php Exists’ and ‘Ampache.cfg.php Configured?’ should now say ‘OK’. Click ‘Continue to Step 3’.</p>
<p>Finally, setup the administrator account. Once you’ve filled out the form, click ‘Create Account’.</p>
<p>Login to your Ampache installation as the administrator. We will now configure Ampache to scan your music collection.</p>
<p>On the menu at the left of the page, click the ‘Admin’ icon (looks like a small server). Then click ‘Add a Catalog’.</p>
<p>The catalog name can be anything you like. ‘Path’ should be set to to the path of your music location. If you are using <code>transmission-daemon</code> and would like all of its downloads to be indexed, use <code>/var/lib/transmission-daemon/downloads/</code>. Then click ‘Add Catalog’.</p>
<p>Once your music collection has been indexed, click ‘Continue’. Now click on the ‘Preferences’ icon in the menu on the left of the page.</p>
<p>If you have opted to transcode FLACs on-the-fly, click on ‘Streaming’ and set your ‘Transcode Bitrate’ to something more reasonable, like 320. Click ‘Update Preferences’ and you’re done.</p>
<h3 id="using-ampache">Using Ampache</h3>
<p>Now you’re ready to use Ampache. Using Ampache is basically a two-step process. First you queue some music into a playlist. Then you open that playlist in a media player which handles the streaming for you.</p>
<h4 id="queueing-music">Queueing Music</h4>
<p>Click on the “Home” icon in the menu on the left. Click on “Albums” to view a list of your albums. If you click the green plus icon next to any album title, it will be loaded into your playlist. You’ll see the tracks in the playlist view on the right side of the screen.</p>
<h4 id="opening-the-playlist">Opening the playlist</h4>
<p>Now that you have some music in the playlist, click the “Play” icon (looks like a broadcast tower) located above the playlist on the right side of the screen. You will be prompted to download a playlist file. Download it and open it with the media player of your choice – Totem or VLC for example. You should hear some music. Enjoy!</p>
<h2 id="conclusion">Conclusion</h2>
<p>Hopefully you now have enough information to build a killer media server. I covered a lot of ground in this guide, so feel free to ask any questions you may have.</p>
  <hr />
  <p>If you enjoyed this post, subscribe to the <a target="_blank" href="http://feedburner.google.com/fb/a/mailverify?uri=noisehack&amp;loc=en_US">Noisehack newsletter</a> or <a href="https://twitter.com/noisehack">follow us on Twitter</a>.
  </p>
  <hr />
  <div id="disqus_thread"></div>
  <script type="text/javascript">
  var disqus_shortname = 'noisehack';
  (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  </script>
</article>

		<aside id="sidebar">
<h2>Subscribe</h2>
<ul>
  <li><a href="http://feedburner.google.com/fb/a/mailverify?uri=noisehack&amp;loc=en_US"><i class="icon-envelope"></i> Newsletter</a></li>
  <li><a href="https://twitter.com/noisehack"><i class="icon-twitter"></i> Twitter</a></li>
  <li><a href="http://feeds.feedburner.com/noisehack"><i class="icon-rss"></i> RSS</a></li>
</ul>
<h2>Recent</h2>
<ul class="recent">
  
  <li><a href="../music-server-revisited-streaming-with-sshfs-and-mp3fs/">Music Server Revisited: Streaming with sshfs and mp3fs</a></li>
  
  <li><a href="../generate-audio-with-python/">Generate Audio with Python</a></li>
  
  <li><a href="../build-a-media-server-with-ampache-and-transmission/">Build a Media Server With Ampache and Transmission</a></li>
  
</ul>
</aside>


		<footer>
<p>
Noisehack is brought to you by <a href="http://zacharydenton.com/">Zach Denton</a>.
</p>
<p>
Grab <a href="http://feeds.feedburner.com/noisehack">the RSS feed</a> or <a href="https://twitter.com/noisehack">follow Noisehack on Twitter</a>.
</p>
</footer>

		</div>
	</body>
</html>
